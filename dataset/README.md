# Dataset 目录说明

## 📁 目录结构

```
dataset/
├── raw_source/              # 原始数据仓库（不修改）
│   ├── ToSarcasm/          # 反讽检测数据集
│   │   ├── train.json
│   │   ├── dev.json
│   │   └── test.json
│   ├── ChnSentiCorp/       # 情感分析数据集
│   │   ├── train.jsonl
│   │   ├── validation.jsonl
│   │   └── test.jsonl
│   └── Weibo/              # 微博情感数据集
│       └── weibo_senti_100k.csv
│
├── processed/              # 清洗后的数据（模型读取）
│   ├── train.json         # 训练集
│   ├── dev.json           # 验证集
│   └── test.json          # 测试集
│
├── cache/                  # HanLP 缓存（自动生成）
│
├── build_dataset_3class.py # 数据清洗脚本（三分类）✅
├── convert_cached_to_jsonl.py  # 格式转换工具
└── README.md              # 本文件
```

## 🎯 三分类标签体系

### 新的标签定义

- **Label 0: 正常-正面 (Normal-Positive)**
  - 真正的夸奖、赞美
  - 来源: ChnSentiCorp 好评 + Weibo 正向

- **Label 1: 正常-负面 (Normal-Negative)**
  - 真正的批评、抱怨
  - 来源: ChnSentiCorp 差评 + Weibo 负向

- **Label 2: 阴阳怪气 (Sarcastic)**
  - 反讽、讽刺、阴阳怪气
  - 来源: ToSarcasm 全部数据

### 设计理念

这种标签体系的优势：
1. ✅ 模型不仅能识别"阴阳怪气"
2. ✅ 还能在非阴阳怪气时判断情感极性
3. ✅ 可以识别"强撑"（正面+反讽概率都高）
4. ✅ 更符合实际应用场景

## 📊 数据集详情

### ToSarcasm（反讽检测数据集）
- **任务**: 反讽检测
- **样本数**: 4,871 条
- **标注**: 全部标注为 Label 2
- **特点**: 
  - 包含 text 和 topic
  - 专门的反讽语料
  - 中文阴阳怪气表达

### ChnSentiCorp（情感分析数据集）
- **任务**: 情感分析
- **样本数**: 12,000 条
- **标注规则**:
  - 原标签 1（好评）→ Label 0（正面）
  - 原标签 0（差评）→ Label 1（负面）
- **特点**: 高质量标注，规范书面语

### Weibo（微博情感数据集）
- **任务**: 情感分析
- **样本数**: 119,988 条
- **标注规则**:
  - 原标签 1（正向）→ Label 0（正面）
  - 原标签 0（负向）→ Label 1（负面）
- **特点**: 真实社交媒体数据，网络用语丰富

## 📈 最终数据规模

### 总计
- **总样本数**: 136,859 条
- **训练集**: 109,486 条
- **验证集**: 13,685 条
- **测试集**: 13,688 条

### 标签分布
- **Label 0 (正面)**: 65,993 条 (48.22%)
- **Label 1 (负面)**: 65,995 条 (48.22%)
- **Label 2 (反讽)**: 4,871 条 (3.56%)

**注意**: 反讽数据相对较少，这是真实场景的反映。训练时可能需要：
- 使用类别权重平衡
- 对反讽数据进行过采样
- 使用 Focal Loss

## 🚀 使用流程

### 步骤 1: 数据清洗
```bash
cd dataset
python build_dataset_3class.py
```

### 步骤 2: 训练模型（三分类）
```bash
cd ..
python main.py --dataset_dir dataset/processed --num_classes 3
```

## 🔧 数据清洗脚本说明

### build_dataset_3class.py

**功能**:
1. 读取三个数据源
2. 重新标注为三分类
3. 平衡和划分数据集
4. 输出统一格式

**输出格式**:
```json
{
  "text": "评论文本",
  "topic": "主题（可选）",
  "label": 0/1/2
}
```

**标注逻辑**:
- ChnSentiCorp: 好评→0, 差评→1
- Weibo: 正向→0, 负向→1
- ToSarcasm: 全部→2

## ⚠️ 重要提示

### 模型修改
使用三分类数据时，必须修改模型：

1. **方法 1**: 命令行参数
   ```bash
   python main.py --num_classes 3
   ```

2. **方法 2**: 修改代码
   在 `model.py` 中将 `num_classes` 默认值改为 3

### 类别不平衡处理
反讽数据只占 3.56%，建议：
- 使用类别权重
- 调整损失函数
- 关注 F1-Score 而非仅看 Accuracy

## 💡 "强撑"识别原理

当模型输出满足以下条件时，可能是"强撑"：
- Label 0 (正面) 概率较高（如 >0.4）
- Label 2 (反讽) 概率也不低（如 >0.2）
- 或者在特征空间中位于 Label 0 和 Label 2 之间

这种情况下，文本可能是"苦笑"、"强颜欢笑"等复杂情感。

## 🎓 学术价值

这种三分类设计：
1. ✅ 更符合真实场景
2. ✅ 可以发表论文（带情感极性的反讽检测）
3. ✅ 有实际应用价值
4. ✅ 可以做消融实验（对比二分类）
